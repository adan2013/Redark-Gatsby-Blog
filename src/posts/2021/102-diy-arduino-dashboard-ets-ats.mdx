---
title: "DIY Arduino Dashboard dla gier ETS/ATS"
slug: "diy-arduino-dashboard-ets-ats"
date: "2021-06-30"
image: "./images/102.jpg"
categories: ["DIY"]
tags: ["gry", "oprogramowanie", "arduino"]
relatedPosts: ["diy-raspberry-book-reader"]
---

<InfoBlock>
This article has English version. Use the button below to see it.
</InfoBlock>

<ActionButton to='/diy-arduino-dashboard-ets-ats-eng'>Go to English version</ActionButton>

Na co dzie zajmuj si programowaniem. Bardzo czsto w 偶yciu programisty pojawia si potrzeba zbudowania i zaprogramowania czego fizycznego. Czego, co nie istnieje wycznie na ekranie komputera, tylko czego, czym mo偶na si pochwali, wskazujc palcem na p贸k w mieszkaniu. Kilka lat temu miaem wanie tak potrzeb i zbudowaem mini drukark, przy u偶yciu posiadanych w贸wczas klock贸w Lego Mindstorms. Nie byo to jednak co dla mnie. Mindstorms cho fajny, to stawia jednak pewne ograniczenia - technologiczne oraz cenowe, tak jak przystao na tego popularnego producenta klock贸w.

Jaki czas temu ta potrzeba powr贸cia. W tamtej chwili do du偶o je藕dziem relaksacyjnie po Europie w grze Euro Truck Simulator 2. Z czasem YouTube zacz mi podrzuca ogromne iloci przer贸偶nych filmik贸w z projektami DIY do tej gry. Od prostych podzespo贸w pokroju "button box'贸w", a偶 po cae kokpity odwzorowujce wiernie wntrza ci偶ar贸wek. Postanowiem spr贸bowa wykona sobie gad偶et do tej gry i tym samym przetestowa swoje umiejtnoci do babrania si w elektronice. Projekt by robiony po godzinach i mia wiele kilkutygodniowych przerw, wic od pomysu do jego realizacji mino ponad 1,5 roku. Dzi mam nareszcie przyjemno pokaza Wam rezultat tego przedsiwzicia. Jest to m贸j pierwszy projekt tego typu, wic nie wszystko jest w nim zrobione idealnie, ale mimo to udao mi si go dowie藕 do koca.

Chcc zaprezentowa projekt troch bardziej dynamicznie, postanowiem przygotowa kr贸tki filmik pokazujcy z grubsza wszystkie jego funkcje. Monta偶 wideo mo偶e nie zachwyca, ale jak na weekendowy przyspieszony kurs obsugi DaVinci Resolve, to sdz, 偶e jest w miar okej . Bez przedu偶ania, zapraszam na pokaz, a p贸藕niej do artykuu opisujcego proces realizacji projektu:

<YouTube id="KW6sZINNi9Y" title="DIY Arduino Dashboard" />

## Prezentacja projektu

<Gallery>
![diy arduino dashboard](images/IMG_20210618_225118_redark.jpg)
![diy arduino dashboard](images/IMG_20210618_224241_redark.jpg)
</Gallery>

Projekt z zewntrz. Zegary zostay zamknite w drewnianej prostopadociennej obudowie, kt贸ra zostaa wycita laserowo na zam贸wienie. Z lewej strony znajduje si port USB typu B su偶cy do komunikacji umieszczonego wewntrz Arduino z komputerem. Z tyu widoczny jest potencjometr do regulacji nat偶enia podwietlenia zegar贸w, a tak偶e gniazdo DC, kt贸rym mo偶na dostarczy zasilanie 12V. Jest ono wykorzystywane tylko do podwietlania zegar贸w, wic urzdzenie mo偶e pracowa i bez niego. Z frontu widoczne s cztery analogowe zegary: du偶y prdkociomierz i obrotomierz, a tak偶e mae wskaz贸wki poziomu paliwa oraz cinienia w ukadzie hamulcowym. Na rodku, pomidzy du偶ymi zegarami, znajduje si may wywietlacz LCD o przektnej 2,4 cala. Cao mo偶e sta pasko na biurku lub zosta postawiona na specjalnej podstawce, kt贸ra ustawia zegary pod ktem, aby uatwi korzystanie z nich przy komputerze.

<AdSense/>

### Kontrolki ostrzegawcze

W zegarach samochodowych nie mogo zabrakn rzecz jasna wielokolorowych kontrolek. W innych projektach tego typu, kt贸re widziaem na YT, kontrolki miay czsto form kilku surowych diod LED wbitych w kawaek tektury lub deski - mnie takie co nie satysfakcjonowao, wic postanowiem p贸j o krok dalej. Urzdzenie posiada cznie 16 kontrolek - 7 ukrytych w tarczy lewego zegara, 7 ukrytych w prawym zegarze oraz dwa kierunkowskazy znajdujce si u g贸ry frontu obudowy.

![kontrolki ostrzegawcze zegar贸w](images/IMG_20210618_231410_redark.jpg)

<ImageDescription>Kontrolki i podwietlenie zegar贸w w penej okazaoci</ImageDescription>

Idc od lewej do prawej mamy tutaj kontrolki o nastpujcym znaczeniu:

- **Awaria silnika** (偶贸ta) - zapala si, gdy poziom uszkodze ci偶ar贸wki bdzie zbyt wysoki,
- **Grzanie wiec** (偶贸ta) - zapala si po wczeniu zaponu,
- **wiata kr贸tkie** (zielona) - informuje o wczeniu wiate mijania,
- **wiata dugie** (niebieska) - informuje o wczeniu wiate drogowych,
- **Dystrybutor** (偶贸ta) - zapala si, gdy poziom paliwa jest zbyt niski,
- **Podniesiona o** (偶贸ta) - uruchamia si, gdy jedna z osi w ci偶ar贸wce lub naczepie jest podniesiona do g贸ry,
- **Blokada dyferencjau** (偶贸ta) - informuje o zablokowaniu mechanizmu r贸偶nicowego w ci偶ar贸wce,
- **Tempomat** (zielona) - zapala si po wczeniu tempomatu,
- **Spanie** (czerwona) - informuje o koniecznoci zatrzymania si na nocleg,
- **Awaria hamulc贸w** (czerwona) - mruga, gdy cinienie w ukadzie hamulcowym jest zbyt niskie,
- **Parking** (czerwona) - informuje o wczonym hamulcu parkingowym,
- **Akumulator** (czerwona) - zapala si po uruchomieniu zaponu,
- **Olej** (czerwona) - zapala si po uruchomieniu zaponu,
- **Retarder** (zielona) - informuje o hamowaniu przy u偶yciu retardera.

### Komputer pokadowy

Bardzo dumny jestem z komputera pokadowego wywietlanego na ekranie LCD zegar贸w. Kontrolowany jest on za pomoc trzech wybranych przez u偶ytkownika przycisk贸w na klawiaturze lub innym kontrolerze podczonym do komputera. Posiada 7 r贸偶nych ekran贸w prezentujcych rozmaite dane o stanie ci偶ar贸wki, naczepy oraz o aktualnie przyjtym zleceniu. Jeden z nich mo偶e zosta spersonalizowany przez u偶ytkownika i to nawet z poziomu menu zegar贸w, kt贸re wywouje si naciniciem przycisku OK. W menu opr贸cz personalizacji ekranu parametr贸w znajduje si r贸wnie偶 zmiana logotypu pokazywanego podczas uruchamiania silnika oraz wiele innych ustawie dotyczcych np. dziaania zegara lub odtwarzania d藕wik贸w ostrzegawczych. Znajduje si tam nawet narzdzie do pomiaru przyspieszenia ci偶ar贸wki. Pozwala ono wybra docelow prdko ci偶ar贸wki, a nastpnie automatycznie wykonuje pomiar czasu, kt贸ry upyn midzy ruszeniem z miejsca a osigniciem zadanej prdkoci.

Opr贸cz wymienionych przed chwil parametr贸w, na ekranie komputera podczas jazdy cay czas widoczne jest kilka podstawowych informacji. U g贸ry wywietlana jest godzina (z gry lub rzeczywista - w zale偶noci od wybranych ustawie), prdko tempomatu oraz numer wbitego biegu wraz z asystentem ekologicznej zmiany przeo偶e (strzaki g贸ra/d贸). U dou widoczny jest przebieg pojazdu, aktualnie wybrany stopie retardera oraz limit prdkoci obowizujcy na danym odcinku trasy. Opr贸cz tego komputer jest w stanie wywietla kr贸tkie powiadomienia tekstowe u dou ekranu informujce o podczeniu naczepy, otrzymaniu mandatu, zapacie za przejazd przez autostrad itp. Poszczeg贸lne ekrany mo偶ecie zobaczy w zestawieniu umieszczonym poni偶ej:

![ekrany komputera pokadowego ci偶ar贸wki](images/lcd_screen_compilation.jpg)

<ImageDescription>Poszczeg贸lne ekrany komputera pokadowego</ImageDescription>

### Przykadowa trasa

Zanim przejd do omawiania budowy i zasady dziaania zegar贸w, podrzucam jeszcze kompilacj fragment贸w z przykadowej jazdy w grze Euro Truck Simulator 2, jak wykonaem z zegarami:

<YouTube id="NMoZSP29ytk" title="DIY Arduino Dashboard Euro Truck Simulator 2" />

## Zasada dziaania

Om贸wi teraz pokr贸tce, na jakiej zasadzie dziaa to urzdzenie oraz jak odczytuje dane z gry.

### Telemetria gier SCS Software

Wszystko zaczyna si od biblioteki do obsugi telemetrii dostarczonej przez SCS Software. Umo偶liwia ona dostp do danych gry i odczyt parametr贸w ci偶ar贸wki, naczepy, trasy, zlecenia i wielu innych rzeczy. Ma ona posta pojedynczego pliku DLL, kt贸ry nale偶y umieci w odpowiednim katalogu gry. Po skopiowaniu pliku do okrelonego miejsca i uruchomieniu gry bdziemy od teraz widzieli komunikat ostrzegawczy informujcy o korzystaniu z narzdzi deweloperskich. Nie da si tego omin i musi ono by ka偶dorazowo zaakceptowane, aby zewntrzne aplikacje na komputerze miay dostp do naszej gry.

### Interpreter telemetrii

Biblioteka telemetryczna dostarcza jednak tylko surowe dane, kt贸re nie s za bardzo przydatne zegarom. Potrzebny jest program, kt贸ry odbierze te dane, przetworzy je w odpowiedni spos贸b i wyle gotowe komendy przez kabel USB do Arduino. Tym programem jest napisana przeze mnie aplikacja w jzyku C#, kt贸rej wygld mo偶ecie zobaczy poni偶ej:

![scs software telemetry interpreter c#](images/scs_software_telemetry_interpreter.jpg)

<ImageDescription>Interpreter telemetri zosta napisany w C#</ImageDescription>

Znajduje si tutaj kompletny zestaw przycisk贸w umo偶liwiajcych pen kontrol wszystkich funkcji zawartych w projekcie. W g贸rnym lewym rogu znajduj si przyciski odpowiedzialne za obsug kontrolek LED oraz podwietlenia tarcz i wskaz贸wek. Poni偶ej nich znajduje si sekcja "Program" umo偶liwiajca wczenie jednego z czterech tryb贸w pracy:

- **Home** - powr贸t urzdzenia do stanu startowego (domowego),
- **Manual** - umo偶liwia rczne sterowanie zegarami z poziomu aplikacji,
- **Test** - przeprowadza w ptli procedur testow wszystkich element贸w skadowych zegar贸w (moglicie j zobaczy na filmiku prezentacyjnym),
- **Telemetry** - przecza na sterowanie przy pomocy telemetrii gry ETS lub ATS.

<AdSense/>

Nastpnie w sekcji "Screen and Sound" znajduj si przyciski kontrolujce wywietlacz LCD oraz d藕wiki ostrze偶e odtwarzane przy pomocy gonik贸w lub suchawek podczonych do komputera. Prawa kolumna interfejsu aplikacji prezentuje cztery poziome suwaki odpowiedzialne za kontrol pozycji czterech wskaz贸wek zegar贸w. Towarzysz im r贸wnie偶 przyciski MIN, MAX, a tak偶e HOME RESET, kt贸ry umo偶liwia naprawienie bdnej pozycji wyjciowej wskaz贸wek. Sekcja "Options" zawiera zestaw siedmiu przycisk贸w reprezentujcych ustawienia pracy zegar贸w. Cz z nich mo偶na zmieni z poziomu menu samego urzdzenia, a cz tylko tutaj. Podwietlenie przycisku wiadczy o aktywacji funkcji, kt贸r reprezentuje. Znaczenie wszystkich funkcji podaj poni偶ej:

- **Keyboard** - reakcja na zdefiniowane skr贸ty klawiszowe,
- **Sound** - w./wy. ostrze偶e d藕wikowych,
- **Speed Limit Warn** - ostrze偶enia o przekroczeniu dozwolonej w danym miejscu prdkoci,
- **Clock 24h** - przeczenie midzy zegarem 12 a 24-godzinnym,
- **Real Time Clock** - umo偶liwia wywietlanie na ekranie zegara czasu realnego (wg komputera) lub wirtualnego czasu pochodzcego z gry,
- **Eco Shift** - w./wy. asystenta ekologicznej zmiany bieg贸w,
- **Diff Lock** - stan aktywacji blokady dyferencjau w ci偶ar贸wce (opowiem o nim jeszcze p贸藕niej).

Sekcja "Customization" zawiera pi opcji personalizacyjnych. "Init Image" umo偶liwia wyb贸r jednego z omiu logotyp贸w pojawiajcych si na ekranie komputera pokadowego podczas uruchamiania ci偶ar贸wki, natomiast pozostae odpowiedzialne s za wyb贸r zawartoci czterech p贸l personalizowanego ekranu komputera pokadowego nazywanego "asystentem". U偶ytkownik mo偶e wybiera z listy 14 r贸偶nych parametr贸w zbieranych przez telemetri gry. Modyfikacja wszystkich opcji jest mo偶liwa z poziomu aplikacji, jak i menu zegar贸w.

Na koniec pozostay jeszcze dwie mae poziome sekcje u dou okna aplikacji. Sekcja "Connection" pozwala wybra wirtualny port COM, kt贸ry reprezentuje Arduino podczone do komputera. Jeli w systemie jest dostpny tylko jeden taki port, aplikacja spr贸buje nawiza poczenie automatycznie. Drug sekcj jest "Keyboard shortcuts", kt贸ra umo偶liwia zdefiniowanie czterech skr贸t贸w klawiszowych su偶cych do sterowania zegarami. Pozycja Left, Ok i Right jest raczej ju偶 znana - su偶 one do nawigacji po menu komputera pokadowego. Tajemnicza jest za to opcja "Diff Lock", kt贸r nale偶y przypisa pod przycisk, pod kt贸rym mamy ustawion blokad dyferencjau w grze. Dlaczego? Ju偶 tumacz.

Telemetria gier ETS i ATS nie jest zrobiona perfekcyjnie i posiada pewne braki, kt贸re uniemo偶liwiaj dostp do wielu parametr贸w ci偶ar贸wki. Jednym z tych brak贸w jest wanie niemo偶no odczytania stanu blokady dyferencjau w ci偶ar贸wce. Bardzo chciaem mie ow kontrolk w swoich zegarach, wic musiaem dopuci si tutaj pewnego oszustwa. Ka偶dorazowe wcinicie na klawiaturze przycisku odpowiedzialnego za zablokowanie lub odblokowanie dyferencjau powoduje przeczenie opcji "Diff Lock", a tym samym zapalenie lub zgaszenie kontrolki ostrzegawczej. Nie jest to rozwizanie idealne, poniewa偶 stan kontrolki mo偶e si "rozsynchronizowa" z gr i ci偶ar贸wk, ale inaczej si tego zrobi nie dao. Mimo to, daje to zadowalajcy efekt.

### Komunikacja przez USB

Zadaniem omawianego przed chwil interpretera jest odbieranie i analizowanie telemetrii wysyanej przez gr, a tak偶e generowanie gotowych danych dla zegar贸w. Gdy s ju偶 gotowe, wysyane s przy pomocy kabla USB do urzdzenia w postaci prostych komend. Przeniesienie logiki dziaania zegar贸w do komputera byo wymagane przez bardzo ograniczon moc obliczeniow Arduino oraz trudnoci w debugowaniu jego kodu. rodowisko programistyczne Arduino jest bardzo archaiczne i pisanie w nim bardziej skomplikowanego kodu, to proszenie si o przedwczesn siwizn. List staych reprezentujcych komendy wysyane przez interpreter do zegar贸w pokazuj poni偶ej. Postanowiem nie tumaczy tutaj dokadnie ich znaczenia, aby nie przedu偶a za bardzo tego tekstu oraz nie zanudzi Was na mier moim gldzeniem o tematach programistycznych. M贸wic w skr贸cie, program wysya komendy do Arduino, a ten ustawia wskaz贸wki, kontrolki oraz ekran wedug informacji, jakie otrzyma. Wszystko zrobione tak, aby jak najbardziej odci偶y procesor Arduino.

![komendy komunikacyjne telemetri z zegarami](images/telemetry_connection_commands.jpg)

## Proces tworzenia

Zanim przeszedem do fazy wykonywania tych zegar贸w przez kilka miesicy opracowywaem koncept tego urzdzenia. W gowie rodziy si przer贸偶ne pomysy, a ka偶dy coraz ambitniejszy od poprzedniego. Na pocztku miay to by proste zegary na serwomechanizmach ze zwykymi kontrolkami LED 5 mm i wywietlaczem segmentowym. P贸藕niej pojawi si pomys wykorzystania istniejcych ju偶 zegar贸w i podczenie si do ich styk贸w - pomys prosty, atwy, ale zegary niewyskalowane pod ci偶ar贸wk oraz niepasujce kontrolki kompletnie mi nie odpowiaday. Nastpnym pomysem byo wykorzystanie zegar贸w samochodowych jako bazy i dostosowanie ich pod swoje potrzeby. To by dobry trop, cho pocztkowo miaem zapdy, aby spr贸bowa odwzorowa kokpit Scanii S przy pomocy okrgych ekran贸w OLED, ale cena i dostpno potrzebnych czci szybko odwioda mnie od tego zamiaru. Ostatecznie postanowiem znale藕 kompromis midzy wygldem, a skomplikowaniem budowy. Wszak by to m贸j pierwszy projekt, wic te偶 musiaem si liczy z tym, 偶e wiele rzeczy p贸jdzie nie po mojej myli.

<InfoBlock>Dokadne schematy instalacji zostan udostpnione na kocu tego artykuu.</InfoBlock>

### Dawca zegar贸w

Gdy ju偶 wiedziaem, czego mniej wicej oczekuj, zaczem przeglda oferty licznik贸w samochodowych, aby znale藕 model, kt贸ry bdzie posiada atrakcyjny dla mnie wygld oraz odpowiedni budow wewntrzn (aby przej p贸藕niej szereg modyfikacji). Zegary miay docelowo zosta pozbawione wszelkiej oryginalnej elektroniki sterujcej, tak abym m贸g mie pen kontrol nad kontrolkami oraz wskaz贸wkami. Po paru dniach poszukiwa znalazem w kocu idealnego dawc. By nim **Volkswagen Golf 4. generacji**. Jego zegary bardzo mi si spodobay. Ukad tarcz by idealny i posiada wystarczajco miejsca na zainstalowanie wywietlacza LCD. W sieci znalazem r贸wnie偶 mn贸stwo filmik贸w z ich rozbi贸rk, kt贸re pozwoliy mi pozna budow zestawu jeszcze przed jego zakupem. Wszystkie potrzebne wymiary otrzymaem z filmik贸w dziki obliczaniu proporcji z dugoci podzespo贸w na ekranie. Udao si zaprojektowa ich wygld co do milimetra. Gdy upewniem si co do projektu urzdzenia, zam贸wiem zegary na Allegro. Zdobyem je w miesznie niskiej cenie (40 zotych), poniewa偶 zostay one uszkodzone podczas demonta偶u. Pkniciu uleg plastikowy klosz licznik贸w, ale to kompletnie mi nie przeszkadzao.

<Gallery width='2'>
![zegary dawcy volkswagen golf mk4](images/P1010551_redark.jpg)
![zegary dawcy volkswagen golf mk4](images/P1010572_redark.jpg)
![zegary dawcy volkswagen golf mk4](images/P1010672_redark.jpg)
![zegary dawcy volkswagen golf mk4](images/P1010907_redark.jpg)
</Gallery>

<ImageDescription>Baz projektu byy liczniki Volkswagena Golfa 4. generacji</ImageDescription>

Z zegar贸w pozyskaem tarcze, wskaz贸wki, silniczki krokowe oraz diody SMD LED kontrolek, kt贸re pogrupowaem wedug koloru wiecenia. Opr贸cz tego "po偶yczyem" r贸wnie偶 plastikowy rozbynik, kt贸ry przeszed szereg modyfikacji przy u偶yciu wiertarki oraz pilnik贸w. Przede wszystkim musiaem usun zbdny plastik znajdujcy si pomidzy du偶ymi zegarami. W tym miejscu docelowo mia si znale藕 wywietlacz LCD komputera pokadowego. Druga modyfikacja polegaa na wydr偶eniu korytka pod przewody owietleniowe, kt贸re w mojej wersji musiay i po powierzchni "pytki drukowanej". A skoro ju偶 o niej wspominam...

<AdSense/>

### Zastpstwo dla pytki drukowanej

Tak jak m贸wiem ju偶 wczeniej, chciaem pozby si wszelkiej elektroniki, kt贸ra uniemo偶liwiaaby mi pen kontrol nad podzespoami zegar贸w. Z racji tego, 偶e m贸j poziom wiedzy o elektronice by i z pewnoci nadal jest znikomy, postanowiem, 偶e nie bd oglda si na oryginaln pytk drukowan licznik贸w i spr贸buj zastpi j czym wasnym. Wyb贸r pad na tektur modelarsk i bya to chyba najgupsza decyzja, jak podjem w tym projekcie. Teraz ju偶 wiem, 偶e powinienem zmusi si i p贸j w kierunku dedykowanych pytek PCB. Znale藕 kogokolwiek, kto pom贸gby mi j zaprojektowa oraz zam贸wi. Zostaem jednak przy pomyle tektury i zbudowaem na jej powierzchni cae potrzebne okablowanie. Kosztowao mnie to wiele cierpliwoci (oraz pourywanych kabli i diod), ale jak widzicie, mimo to, udao mi si dowie藕 projekt do koca. Plastikowy reflektor uo偶ony jest na tekturze, do kt贸rej przyklejone s wszystkie kontrolki oraz silniczki krokowe zamontowane za pomoc uchwyt贸w z tektury i spinaczy biurowych. Ka偶dy kabel sygnaowy zosta wyprowadzony do tyu i poczony w miar mo偶liwoci w odpowiednie wizki. Zrobio si z tego nieze spaghetti, ale uwierzcie mi, ja si w nim doskonale orientuj .

<Gallery width='2'>
![pozyskiwanie diod led z oryginalnych zegar贸w](images/P1010693_redark.jpg)
![wizki przewod贸w kontrolek](images/P1010991_redark.jpg)
![acuch led podwietlenia tarcz](images/P1010882_redark.jpg)
![mocowanie silniczk贸w krokowych](images/P1010807_redark.jpg)
</Gallery>

Jeli chodzi o ukad przewod贸w, to kontrolki LED otrzymay przylutowane pod ktem prostym przewody, kt贸re wychodziy na ty urzdzenia. Kable masowe zostay poczone ze sob, natomiast plusowe zostay zakoczone 偶esk wtyczk, kt贸ra miaa zosta p贸藕niej wpita do kontrolera LED, o kt贸rym powiem za niedugo. Podwietlenie wskaz贸wek oraz tarcz zostao poprowadzone po frontowej powierzchni tektury. Biae diody zostay pozyskane ze zwykej tamy LED kupionej w sklepie, poniewa偶 oryginalne zegary Volkswagena posiaday podwietlenie w kolorze niebieskim, kt贸re niezbyt mi si podobao. Nastpnie poczyem diody w acuszki. Czerwone byy czone po dwie sztuki na cie偶k (cznie 6), natomiast biae po 3 sztuki na cie偶k (cznie 15). Plus znajdowa si u g贸ry du偶ych zegar贸w i rozchodzi si na obie strony do dou. Dopasowanie wymiar贸w wszystkich kabli oraz przyklejenie diod do tektury nie byo atwe. Wszystkie elementy musiay by tak spasowane, aby nie przeszkadzay p贸藕niej w zao偶eniu plastikowego rozbynika. Wymagao to wielu poprawek i manewrowania gorc lutownic przy teksturze, ale udao si.

### Kontroler diod LED

Aby m贸c atwo wyjmowa tektur i reflektor z urzdzenia potrzebowaem ograniczy ilo przewod贸w, jaka wychodzia do pozostaych podzespo贸w zegar贸w. Prowadzenie wszystkich szesnastu przewod贸w kontrolek bezporednio do Arduino nie do, 偶e byoby mczce, to jeszcze znaczco uszczuplioby pul dostpnych wyprowadze mikrokontrolera. Wszystkie problemy rozwizao wykorzystanie ukadu scalonego MCP23017. Jest to 16-kanaowy ekspander wyprowadze, kt贸ry czy si z Arduino za pomoc magistrali I2C. Umieciem go na "plecach" tektury, co spowodowao, 偶e zamiast cign do Arduino prawie 20 kabli sygnaowych, wystarczyy tylko cztery - dwa sygnaowe SDA i SCL (magistrala I2C) oraz plus i minus do zasilania.

<Gallery width='2'>
![dob贸r rezystor贸w do diod led](images/P1010747_redark.jpg)
![schemat ukadu](images/P1020054_redark.jpg)
![lutowanie kontrolera led](images/P1020090_redark.jpg)
![gotowy kontroler led](images/P1020093_redark.jpg)
</Gallery>

<ImageDescription>Kontroler sterowania kontrolkami LED</ImageDescription>

Ekspander zosta umieszczony na dwustronnej pytce uniwersalnej, kt贸ra zostaa przytwierdzona do tektury za pomoc uchwyt贸w zrobionych ze spinaczy biurowych. Opr贸cz ukadu scalonego na pytce znalazy si r贸wnie偶 potrzebne do podczenia diod mskie gniazda goldpin, a tak偶e zestaw rezystor贸w dobranych odpowiednio do koloru ka偶dej kontrolki. Przy konstruowaniu ukadu jedynym problemem okazao si ograniczenie prdowe ukadu MCP23017. Wedug noty katalogowej ekspander mo偶e wytrzyma jedynie pob贸r prdu w wysokoci 150 mA. Zmuszony byem wic stopniowa moc dostarczan na ka偶d diod w zale偶noci od jej koloru:

- 5x czerwona dioda po 6 mA (rezystory: 470+47, razem 517 Ohm),
- 5x 偶贸ta dioda po 9 mA (rezystory: 220+100, razem 320 Ohm),
- 5x zielona dioda po 12 mA (rezystory: 100+47, razem 147 Ohm),
- 1x niebieska dioda po 16 mA (rezystory: 47+47, razem 94 Ohm).

Taki dob贸r rezystor贸w pozwoli mi uzyska przyzwoit moc wiecenia wszystkich diod przy zmieszczeniu si w zalecanym poborze prdu.

<AdSense/>

### Kontroler podwietlenia

Opr贸cz kontrolera diod LED w obudowie zegar贸w znajduje si jeszcze druga pytka uniwersalna, kt贸ra z kolei zajmuje si obsug podwietlenia tarcz, wskaz贸wek oraz wywietlacza LCD. Jest ona odrobin bardziej skomplikowana w budowie od swojej poprzedniczki.

<Gallery width='2'>
![cie偶ki pytki kontrolera podwietlenia](images/P1020146_redark.jpg)
![gotowy kontroler podwietlenia](images/P1020147_redark.jpg)
![podczenie kabli na kr贸tko](images/P1020165_redark.jpg)
![test podwietlenia](images/P1020160_redark.jpg)
</Gallery>

<ImageDescription>Kontroler podwietlenia oraz pierwsze testy</ImageDescription>

Przy lewej krawdzi pytki znajduj si gniazda goldpin w kolorze czarnym oraz czerwonym. Su偶 one jako rozdzielacz dla przewod贸w masowych oraz zasilania +12V. Do tych listw podczone jest gniazdo DC znajdujce si z tyu obudowy. U g贸ry pytki znajduje si rzd czterech tranzystor贸w N-MOSFET. Su偶 one do sterowania czterema strefami podwietlenia zegar贸w. Pierwszy odpowiada za podwietlenie du偶ych tarcz, drugi za mae tarcze, trzeci za du偶e wskaz贸wki, a czwarty za mae wskaz贸wki. Pod tranzystorami znajduje si szereg rezystor贸w dopasowanych odpowiednio do poszczeg贸lnych acuch贸w LED. Na pytce znajduje si r贸wnie偶 pity tranzystor mocy, ale o dziaaniu odwrotnym. Jest to tranzystor P-MOSFET i su偶y on do wczania i wyczania podwietlenia wywietlacza LCD. Maa czerwona listwa podczona do jednego z jego wyprowadze su偶y do rozdzielenia napicia 3.3V pochodzcego z Arduino, kt贸re posiada tylko jedno wyprowadzenie tego typu.

Na niekt贸rych zdjciach mo偶ecie zauwa偶y cienk pastylk poczon z pytk kontrolera za pomoc dw贸ch przewod贸w. By to tzw. "buzzer" odpowiedzialny za odtwarzanie prostych komunikat贸w d藕wikowych, lecz w ostatecznej wersji urzdzenia zlikwidowaem go, poniewa偶 zdecydowaem si na odtwarzanie d藕wik贸w za pomoc interpretera telemetrii.

### Silniczki krokowe

Za obracanie wskaz贸wek zegar贸w odpowiedzialne s cztery silniczki krokowe x27.168 wymontowane z licznika Volkswagena. S one przymocowane do g贸wnej tektury za pomoc uchwyt贸w wykonanych z tektury i odpowiednio wyprofilowanego drutu spinacza biurowego. Zapewnia to dobry docisk oraz mo偶liwo demonta偶u podzespou w razie awarii. Do wysterowania pojedynczego silnika potrzeba 4 przewod贸w - po 2 na obie cewki sterujce. Ich wyprowadzenia znajduj si z przodu zegar贸w, wic przewody musiay zosta do nich doprowadzone przez prostoktne otwory w tekturze. Nastpnie kable s zwizywane ze sob zaraz za silniczkiem przy u偶yciu tamy izolacyjnej i id bezporednio do Arduino. Przewody najdalszego licznika (du偶y obrotomierz) zostay dodatkowo przedu偶one, aby nie musiay by silnie napite. Silniczki maj przypisane litery od A do D, idc od lewej strony i patrzc od frontu. Wyprowadzenia zostay oznaczone cyframi. Patrzc od strony osi, po lewej stronie znajduj si przewody 2 i 1, a po prawej 3 i 4. Dokadne podczenie silniczk贸w bdziecie mogli zobaczy na schematach elektrycznych, kt贸re poka偶e pod koniec tego artykuu.

### Wywietlacz LCD

Wa偶nym elementem caego projektu by oczywicie wywietlacz LCD. Posiada on przektn 2,4" i rozdzielczo 240 na 320 pikseli. Jego podczenie i optymalne wysterowanie nie byo atwe. Jednym z problem贸w, jaki musiaem rozwiza, bya konwersja poziom贸w logicznych. Kontroler ILI9341, kt贸ry odpowiedzialny jest za obsug tego ekranu, pracuje na logice i zasilaniu 3,3V, natomiast Arduino na logice 5V. Aby nie uszkodzi ukadu, zastosowaem tutaj gotowy 4-kanaowy konwerter stan贸w logicznych, kt贸ry zosta wpity pomidzy Arduino a wywietlacz. Uformowan wizk przewod贸w wraz z miniaturowym konwerterem mo偶ecie zobaczy poni偶ej tego akapitu. Wszystko zostao spite tak, aby ka偶dy przew贸d wychodzi dokadnie w tym miejscu, w kt贸rym jest potrzebny. Wizka czya ze sob sekcj zasilania Arduino, wyprowadzenia interfejsu SPI, wyjcia wywietlacza, konwerter stan贸w logicznych oraz mosfet odpowiedzialny za wczanie podwietlenia LCD. Ka偶dy kabel posiada r贸wnie偶 etykiety na swoich kocach do atwiejszej identyfikacji.

![wizka kabli wywietlacza](images/P1020872_redark.jpg)

<ImageDescription>Wizka kabli odpowiedzialna za obsug wywietlacza LCD</ImageDescription>

Jeli chodzi o sam wywietlacz, to zastosowaem podobne mocowanie przy u偶yciu spinacza biurowego, co przy pozostaych podzespoach. Tym razem drut nie m贸g przechodzi na drug stron, wic zosta uformowany tak, 偶eby przechodzi przez dwa rowki drewienka trzymajcego krawdzie wywietlacza. Mocowanie to okazao si bardzo skuteczne i rewelacyjnie utrzymuje ekran na swoim miejscu. Dodatkowo jest niezale偶ne od reflektora i pytki, wic nie utrudnia ich wyjmowania.

<Gallery>
![uchwyty mocujce wywietlacz do obudowy](images/P1020801_redark.jpg)
![kodowanie widok贸w wywietlacza](images/P1030016_redark.jpg)
</Gallery>

Sterowanie wywietlaczem byo bardzo trudne, poniewa偶 jego odwie偶anie znaczco pochaniao moc obliczeniow Arduino. Zmusio mnie to do opracowania bardzo optymalnego kodu obsugujcego aktualizowanie informacji na jego powierzchni. Obraz musia by odwie偶any fragmentami i tylko wtedy, kiedy byo to naprawd konieczne. Nie bd opisywa tutaj wszystkich sztuczek, jakie zastosowaem, poniewa偶 troch ich tam byo. Dziaanie zegar贸w nie jest idealne i nadal wida momenty przywieszania si Arduino, ale uwa偶am, 偶e zrobiem wszystko, co byo mo偶liwe, aby temu zapobiec.

### Obudowa

Teraz par s贸w o obudowie, w kt贸rej znajduj si te wszystkie podzespoy. Jest to cita laserowo na zam贸wienie sklejka o gruboci 3 milimetr贸w. Wszystkie wymiary element贸w obliczyem sam, wzorujc si na oryginalnej obudowie licznik贸w. Odrysowaem kontur ich otwor贸w na kartce, nastpnie zeskanowaem, obrobiem w Gimpie, a na kocu przeniosem do oprogramowania CAD. Tak oto metod pr贸b i bd贸w sporzdziem ostateczny projekt obudowy i podstawki, kt贸rych wycicie zleciem p贸藕niej przez Internet. Kilka zdj z procesu projektowania mo偶ecie zobaczy poni偶ej:

<Gallery width='2'>
![odrysowywanie otwor贸w obudowy](images/P1020249_redark.jpg)
![przymiarka wywietlacza](images/P1020253_redark.jpg)
![elementy sklejki obudowy](images/P1020784_redark.jpg)
![sklejanie obudowy](images/P1020826_redark.jpg)
</Gallery>

<ImageDescription>Projektowanie i skadanie obudowy zegar贸w</ImageDescription>

呕auj troch, 偶e nie wziem odrobin grubszej sklejki. Ta tutaj ulega niestety lekkiej deformacji, przez co w jednym miejscu wida nier贸wno, a klapa obudowy nie zamyka si cakowicie. Mimo to ciesz si, 偶e udao si wykona tak obudow. Jest ona elegancka i skrojona na miar. Jedyne modyfikacje, jakie sam w niej wykonaem to wywiercenie otwor贸w pod koki dystansowe Arduino, port USB, gniazdo zasilania 12V oraz potencjometr do regulacji podwietlenia. Na koniec doklejone zostay jeszcze mae elementy su偶ce do utrzymywania zegar贸w na swoim miejscu. Byy to ograniczniki zrobione ze sklejonych drewnianych patyczk贸w na dole obudowy oraz uchwyty w ksztacie litery L znajdujce si na bocznych ciankach. Ich zadaniem jest dociskanie belki rozporowej odpowiedzialnej za dociskanie zegar贸w do frontu obudowy. Te drewienka z kolei zostay uzyskane z resztek sklejki, z kt贸rej bya wycinana obudowa.

<Gallery>
![belka rozporowa reflektora](images/P1020860_redark.jpg)
![ograniczniki reflektora](images/P1020858_redark.jpg)
</Gallery>

<ImageDescription>Mocowanie reflektora i pytki w obudowie</ImageDescription>

<AdSense/>

### Tarcze zegar贸w

Elementem r贸wnie wa偶nym, co sama obudowa, byy rzecz jasna tarcze zegar贸w. Powodem, dla kt贸rego nie zdecydowaem si skorzysta z gotowych licznik贸w samochodowych, byy wanie tarcze. Ich skala jest zupenie inna ni偶 w ci偶ar贸wkach, co bardzo psuje imersj podczas gry. W tym projekcie miay pojawi si dedykowane, przygotowane przeze mnie skale licznik贸w. Potrzebowaem do tego dw贸ch rzeczy. Oryginalnych tarcz od tego licznika oraz programu, kt贸ry pozwoliby mi wygenerowa nowe grafiki. Z pierwszym elementem nie byo problemu. Zeskanowaem oryginalne tarcze skanerem, owietlajc je dodatkowo latark, aby uwydatni p贸prze藕roczyste kontrolki ostrzegawcze. Wygenerowanie nowych tarcz byo znacznie wikszym problemem, poniewa偶 nie znalazem w Internecie za bardzo programu umo偶liwiajcego tworzenie takich tarcz. Co mogem zrobi? To, co ka偶dy programista - jeli program, kt贸rego potrzebujesz, nie istnieje, to go sobie stw贸rz. Tak te偶 zrobiem i stworzyem [program "Gauge Generator"](https://github.com/adan2013/Gauge-Generator), kt贸ry od jakiego czasu widnieje na moim profilu GitHub. Pozwala on wygenerowa dowolnie wygldajce tarcze zegar贸w. Aplikacja nie jest jako super dopracowana, ale spenia swoje zadanie i pozwolia mi stworzy grafiki, kt贸re widzicie teraz w ostatecznej wersji urzdzenia.

<Gallery>
![obr贸bka tarcz zegar贸w](images/gimp_tarcze_redark.jpg)
![gauge generator program](images/gauge_generator_redark.jpg)
</Gallery>

<ImageDescription>Przygotowywanie dedykowanych tarcz zegar贸w odbywao si w Gimpie oraz autorskim programie Gauge Generator</ImageDescription>

Drugim etapem szykowania tarcz byo oczywicie ich wydrukowanie i sklejenie. Z racji tego, 偶e miay one przepuszcza i blokowa wiato w odpowiedni spos贸b, nie mogy zosta wykonane na zwykej kartce biaego papieru. Rozpoczem wic testy. Pierwsze wersje byy wydrukowane w negatywie, aby oszczdzi toner. Posu偶yy mi do zweryfikowania rozmiaru tarcz oraz stylu kontrolek. Gdy umiejscowienie element贸w byo ju偶 dobre, rozpoczem testy na czarnych wersjach. Sprawdzaem przepuszczalno wiata na trzech r贸偶nych materiaach: biaej, standardowej kartce, prze藕roczystej folii do drukarek laserowych oraz kalce technicznej. Na poni偶szych zdjciach mo偶ecie zobaczy pierwsz powa偶n wersj tarcz. Jak widzicie, wiato przebijao si przez czarne obszary, a prawa strona ewidentnie rozjechaa si midzy warstwami. Kontrolki byy bardzo sabo widoczne w socu i r贸wnie偶 przebijay wyra藕nie czarne to zegar贸w. Wszystkie zebrane dane posu偶yy mi do stworzenia kolejnego prototypu, kt贸ry okaza si ju偶 wersj ostateczn, cho zastpion p贸藕niej drugim egzemplarzem z powodu pcherzy powietrza, jakie pojawiy si na powierzchni kalki po kilkunastu dniach od wykonania tarcz.

<Gallery>
![pierwsza wersja z przewitami](images/1621957373814_redark.jpg)
![pierwsza wersja z przewitami](images/1621957373838_redark.jpg)
</Gallery>

<ImageDescription>Pierwsza wersja tarcz posiadaa widoczne przewity oraz lekko niedopasowane to</ImageDescription>

Ostateczna wersja tarcz skada si z czterech warstw. Trzech prze藕roczystych folii z nadrukowanymi kontrolkami oraz wierzchniej kalki technicznej pozbawionej kontrolek, aby byy one niewidoczne, gdy nie s podwietlone. Poczenie takiego zestawu materia贸w stworzyo tarcze o przepuszczalnoci bardzo zbli偶onej do oryginau. Zastosowanie krzy偶yk贸w pozycjonujcych oraz klejenie warstw na szklanym stole podwietlanym siln latark warsztatow pozwolio bardzo precyzyjnie sklei wszystkie warstwy ze sob. Do ich czenia u偶yem kleju w sprayu. Jego wad byo to, 偶e zostawia mokre kropelki na powierzchni warstw, kt贸re byy widoczne po ich podwietleniu, ale za to bardzo dobrze czy arkusze ze sob. Aby unikn pcherzy powietrza, po ka偶dorazowym klejeniu przykrywaem zegary czyst kart papieru, a nastpnie wyciskaem powietrze przy u偶yciu plastikowej ekierki. Brak kartki ochronnej powodowa momentalne zdrapywanie si tonera z powierzchni folii oraz kalki. Na koniec cao tarcz zostaa doci偶ona na noc, aby klej m贸g porzdnie zwiza.

<Gallery>
![klejenie warstw tarcz zegar贸w](images/1621957373766_redark.jpg)
![podwietlone tarcze](images/1621957373744_redark.jpg)
</Gallery>

<ImageDescription>Sklejanie tarcz zegar贸w odbywao si na szklanym podwietlanym stole</ImageDescription>

Przygotowanie tarcz byo du偶ym wyzwaniem, ale uwa偶am, 偶e efekt kocowy by tego wart. Prezentuj si fenomenalnie i s sto razy lepsze ni偶 niewyskalowane tarcze pochodzce z samochod贸w osobowych. Nawet rozebranie na czynniki pierwsze mojej drukarki laserowej, kt贸ra zaniemoga podczas ich przygotowywania, byo tego warte .

## Podsumowanie projektu

### Kosztorys

W przypadku projekt贸w DIY wiele os贸b chce wiedzie, jaki by ostateczny koszt przygotowania takiego urzdzenia. Postanowiem przygotowa przybli偶ony kosztorys wszystkich czci, jakich u偶yem w projekcie. Par pozycji ci偶ko byo wyceni, poniewa偶 wykorzystaem np. tylko cz ich zawartoci. Do kwoty nie wliczaem r贸wnie偶 wszelkich narzdzi, kt贸re musiaem zakupi do wykonania tego projektu. Wikszo pozycji z tej listy zostaa zakupiona w polskim sklepie z elektronik [Botland](https://botland.com.pl/). Kosztorys prezentuj poni偶ej:

![kosztorys projektu](images/kosztorys_diy_arduino_dashboard.jpg)

<ImageDescription>Kosztorys projektu DIY Arduino Dashboard</ImageDescription>

Jak widzicie, cakowity koszt wykonaniu projektu plasuje si midzy 300 a 350 zotych. Czy to du偶o, czy to mao, ocecie sami. Dla mnie nie jest to du偶a cena, zwaszcza jeli wzi pod uwag efekt kocowy, jaki udao si uzyska. Wszelkie podobne projekty znalezione w Internecie nie umywaj si do tych zegar贸w.

<AdSense/>

### Schematy elektryczne

Zgodnie z obietnic, poni偶ej znajdziecie schematy elektryczne wszystkich pocze midzy podzespoami, jakie znajduj si w obudowie zegar贸w. Gdyby kt贸re z pocze byo nie jasne, chtnie wytumacz ich znaczenie w sekcji komentarzy pod tym artykuem.

![schemat elektryczny zegar贸w](images/schema_diy_arduino_dashboard.jpg)

<ImageDescription>Kompletne schematy elektryczne urzdzenia</ImageDescription>

### Moja opinia o projekcie

Po pierwsze ciesz si, 偶e udao mi si dokoczy ten projekt. Tak jak m贸wiem, to by pierwszy taki projekt w moim 偶yciu i zaczynaem go z zerow wiedz o elektronice, mylc napicie prdu z jego nat偶eniem. Porywanie si na tak rozbudowany projekt bez dowiadczenia byo do szalonym pomysem, std jest par rzeczy, kt贸re mogem zrobi lepiej. Najwikszym moim bdem byo niezastosowanie dedykowanego PCB, kt贸rego obecno znaczco uatwiaby wykonanie projektu i odchudzia pltanin kabli w obudowie. Pogodzenie sterowania wskaz贸wek z zasobo偶ernym wywietlaczem te偶 nie jest zrobione idealnie i zegary maj problem z przywieszaniem si. Jednak ciesz si, 偶e udao mi si umieci w tym projekcie komputer pokadowy. Jestem z niego naprawd dumny i dobrze, 偶e nie pozostaem przy pomyle u偶ycia zwykego wywietlacza segmentowego.

### Repozytorium GitHub

A teraz czas na open source. Cay kod interpretera telemetrii, kod Arduino, pliki z grafikami, projekty tarcz - wszystko, co stworzyem w tym projekcie, jest dostpne w publicznym repozytorium na GitHubie. Chtni mog przeledzi dziaanie zegar贸w w najmniejszym szczeg贸le:

<ActionButton to='https://github.com/adan2013/DIY-Arduino-Dashboard'>Przejd藕 do GitHuba</ActionButton>

### Przysze projekty

To by byo na tyle. Na pewno nie jest to koniec mojej przygody z elektronik. W gowie mam ju偶 pomysy na kolejne projekty, a jeden z nich (nie do koca planowany) zosta ju偶 nawet przeze mnie sfinalizowany i r贸wnie偶 pojawi si wkr贸tce na tym portalu. Jeli spodoba si Wam ten projekt, koniecznie dajcie zna o tym w sekcji komentarzy. Spdza mi on sen z powiek przez wiele miesicy i jest dla mnie bardzo wa偶ny, wic ciesz si, 偶e nareszcie mogem go Wam pokaza.
